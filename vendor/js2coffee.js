if(typeof module=="undefined"){this.Narcissus=new Object}(function(){var e={options:{version:185},hostGlobal:this};Narcissus=e})();Narcissus.definitions=function(){function h(e,t,n,r,i){Object.defineProperty(e,t,{get:n,configurable:!r,enumerable:!i})}function p(e,t,n,r,i,s){Object.defineProperty(e,t,{value:n,writable:!i,configurable:!r,enumerable:!s})}function d(e){return typeof e==="function"&&e.toString().match(/\[native code\]/)}function v(e,t){while(e){if({}.hasOwnProperty.call(e,t))return Object.getOwnPropertyDescriptor(e,t);e=Object.getPrototypeOf(e)}}function m(e){var t={};for(var n in Object.getOwnPropertyNames(e))t[n]=Object.getOwnPropertyDescriptor(e,n);return t}function g(e){return{getOwnPropertyDescriptor:function(t){var n=Object.getOwnPropertyDescriptor(e,t);n.configurable=true;return n},getPropertyDescriptor:function(t){var n=v(e,t);n.configurable=true;return n},getOwnPropertyNames:function(){return Object.getOwnPropertyNames(e)},defineProperty:function(t,n){Object.defineProperty(e,t,n)},"delete":function(t){return delete e[t]},fix:function(){if(Object.isFrozen(e)){return m(e)}return undefined},has:function(t){return t in e},hasOwn:function(t){return{}.hasOwnProperty.call(e,t)},get:function(t,n){return e[n]},set:function(t,n,r){e[n]=r;return true},enumerate:function(){var t=[];for(f in e){t.push(f)}return t},keys:function(){return Object.keys(e)}}}function y(){return undefined}function w(){this.table=Object.create(null,{});this.size=0}function E(e){this.elts=e||null}var e=["END","\n",";",",","=","?",":","CONDITIONAL","||","&&","|","^","&","==","!=","===","!==","<","<=",">=",">","<<",">>",">>>","+","-","*","/","%","!","~","UNARY_PLUS","UNARY_MINUS","++","--",".","[","]","{","}","(",")","SCRIPT","BLOCK","LABEL","FOR_IN","CALL","NEW_WITH_ARGS","INDEX","ARRAY_INIT","OBJECT_INIT","PROPERTY_INIT","GETTER","SETTER","GROUP","LIST","LET_BLOCK","ARRAY_COMP","GENERATOR","COMP_TAIL","IDENTIFIER","NUMBER","STRING","REGEXP","break","case","catch","const","continue","debugger","default","delete","do","else","false","finally","for","function","if","in","instanceof","let","new","null","return","switch","this","throw","true","try","typeof","var","void","yield","while","with"];var t=["break","const","continue","debugger","do","for","if","return","switch","throw","try","var","yield","while","with"];var n={"\n":"NEWLINE",";":"SEMICOLON",",":"COMMA","?":"HOOK",":":"COLON","||":"OR","&&":"AND","|":"BITWISE_OR","^":"BITWISE_XOR","&":"BITWISE_AND","===":"STRICT_EQ","==":"EQ","=":"ASSIGN","!==":"STRICT_NE","!=":"NE","<<":"LSH","<=":"LE","<":"LT",">>>":"URSH",">>":"RSH",">=":"GE",">":"GT","++":"INCREMENT","--":"DECREMENT","+":"PLUS","-":"MINUS","*":"MUL","/":"DIV","%":"MOD","!":"NOT","~":"BITWISE_NOT",".":"DOT","[":"LEFT_BRACKET","]":"RIGHT_BRACKET","{":"LEFT_CURLY","}":"RIGHT_CURLY","(":"LEFT_PAREN",")":"RIGHT_PAREN"};var r={__proto__:null};var i={};var s="const ";for(var o=0,u=e.length;o<u;o++){if(o>0)s+=", ";var a=e[o];var f;if(/^[a-z]/.test(a)){f=a.toUpperCase();r[a]=o}else{f=/^\W/.test(a)?n[a]:a}s+=f+" = "+o;i[f]=o;e[a]=o}s+=";";var l={__proto__:null};for(o=0,u=t.length;o<u;o++)l[r[t[o]]]=true;var c=["|","^","&","<<",">>",">>>","+","-","*","/","%"];for(o=0,u=c.length;o<u;o++){a=c[o];c[a]=e[a]}var b={}.hasOwnProperty;w.prototype={has:function(e){return b.call(this.table,e)},set:function(e,t){if(!b.call(this.table,e))this.size++;this.table[e]=t},get:function(e){return this.table[e]},getDef:function(e,t){if(!b.call(this.table,e)){this.size++;this.table[e]=t()}return this.table[e]},forEach:function(e){var t=this.table;for(var n in t)e.call(this,n,t[n])},toString:function(){return"[object StringMap]"}};E.prototype={push:function(e){return new E({top:e,rest:this.elts})},top:function(){if(!this.elts)throw new Error("empty stack");return this.elts.top},isEmpty:function(){return this.top===null},find:function(e){for(var t=this.elts;t;t=t.rest){if(e(t.top))return t.top}return null},has:function(e){return Boolean(this.find(function(t){return t===e}))},forEach:function(e){for(var t=this.elts;t;t=t.rest){e(t.top)}}};return{tokens:e,opTypeNames:n,keywords:r,isStatementStartCode:l,tokenIds:i,consts:s,assignOps:c,defineGetter:h,defineProperty:p,isNativeCode:d,makePassthruHandler:g,noPropFound:y,StringMap:w,Stack:E}}();Narcissus.lexer=function(){function Tokenizer(e,t,n){this.cursor=0;this.source=String(e);this.tokens=[];this.tokenIndex=0;this.lookahead=0;this.scanNewlines=false;this.unexpectedEOF=false;this.filename=t||"";this.lineno=n||1;this.comments=[]}var definitions=Narcissus.definitions;eval(definitions.consts);var opTokens={};for(var op in definitions.opTypeNames){if(op==="\n"||op===".")continue;var node=opTokens;for(var i=0;i<op.length;i++){var ch=op[i];if(!(ch in node))node[ch]={};node=node[ch];node.op=op}}Tokenizer.prototype={get done(){return this.peek(true)===END},get token(){return this.tokens[this.tokenIndex]},match:function(e,t){return this.get(t)===e||this.unget()},mustMatch:function(e){if(!this.match(e)){throw this.newSyntaxError("Missing "+definitions.tokens[e].toLowerCase())}return this.token},peek:function(e){var t,n;if(this.lookahead){n=this.tokens[this.tokenIndex+this.lookahead&3];t=this.scanNewlines&&n.lineno!==this.lineno?NEWLINE:n.type}else{t=this.get(e);this.unget()}return t},peekOnSameLine:function(e){this.scanNewlines=true;var t=this.peek(e);this.scanNewlines=false;return t},skip:function(){var e=this.source;var t;var n;var r=[];var i;var s=0;for(;;){var o=e[this.cursor++];var u=e[this.cursor];if(o==="\n"&&!this.scanNewlines){this.lineno++;s++}else if(o==="/"&&u==="*"){t=this.cursor;n=this.lineno;this.cursor++;for(;;){o=e[this.cursor++];if(o===undefined)throw this.newSyntaxError("Unterminated comment");if(o==="*"){u=e[this.cursor];if(u==="/"){this.cursor++;i={type:"BLOCK_COMMENT",nlcount:s,start:t-1,end:this.cursor,lineno:n,endlineno:this.lineno,value:e.substring(t+1,this.cursor-2)};this.comments.push(i);s=0;break}}else if(o==="\n"){this.lineno++}}}else if(o==="/"&&u==="/"){t=this.cursor;this.cursor++;for(;;){o=e[this.cursor++];if(o===undefined){i={type:"LINE_COMMENT",start:t,end:this.cursor,lineno:this.lineno,nlcount:s,value:e.substring(t+1,this.cursor-1)};this.comments.push(i);return}if(o==="\n"){i={type:"LINE_COMMENT",start:t,end:this.cursor,lineno:this.lineno,nlcount:s,value:e.substring(t+1,this.cursor-1)};this.comments.push(i);s=0;this.lineno++;break}}}else if(o!==" "&&o!=="	"){this.cursor--;return}}},lexExponent:function(){var e=this.source;var t=e[this.cursor];if(t==="e"||t==="E"){this.cursor++;ch=e[this.cursor++];if(ch==="+"||ch==="-")ch=e[this.cursor++];if(ch<"0"||ch>"9")throw this.newSyntaxError("Missing exponent");do{ch=e[this.cursor++]}while(ch>="0"&&ch<="9");this.cursor--;return true}return false},lexZeroNumber:function(e){var t=this.token,n=this.source;t.type=NUMBER;e=n[this.cursor++];if(e==="."){do{e=n[this.cursor++]}while(e>="0"&&e<="9");this.cursor--;this.lexExponent();t.value=parseFloat(t.start,this.cursor)}else if(e==="x"||e==="X"){do{e=n[this.cursor++]}while(e>="0"&&e<="9"||e>="a"&&e<="f"||e>="A"&&e<="F");this.cursor--;t.value=parseInt(n.substring(t.start,this.cursor))}else if(e>="0"&&e<="7"){do{e=n[this.cursor++]}while(e>="0"&&e<="7");this.cursor--;t.value=parseInt(n.substring(t.start,this.cursor))}else{this.cursor--;this.lexExponent();t.value=0}},lexNumber:function(e){var t=this.token,n=this.source;t.type=NUMBER;var r=false;do{e=n[this.cursor++];if(e==="."&&!r){r=true;e=n[this.cursor++]}}while(e>="0"&&e<="9");this.cursor--;var i=this.lexExponent();r=r||i;var s=n.substring(t.start,this.cursor);t.value=r?parseFloat(s):parseInt(s)},lexDot:function(e){var t=this.token,n=this.source;var r=n[this.cursor];if(r>="0"&&r<="9"){do{e=n[this.cursor++]}while(e>="0"&&e<="9");this.cursor--;this.lexExponent();t.type=NUMBER;t.value=parseFloat(t.start,this.cursor)}else{t.type=DOT;t.assignOp=null;t.value="."}},lexString:function(ch){var token=this.token,input=this.source;token.type=STRING;var hasEscapes=false;var delim=ch;while((ch=input[this.cursor++])!==delim){if(this.cursor>=input.length)throw this.newSyntaxError("Unterminated string literal");if(ch==="\\"){hasEscapes=true;if(++this.cursor==input.length)throw this.newSyntaxError("Unterminated string literal")}}token.value=hasEscapes?eval(input.substring(token.start,this.cursor)):input.substring(token.start+1,this.cursor-1)},lexRegExp:function(ch){var token=this.token,input=this.source;token.type=REGEXP;do{ch=input[this.cursor++];if(ch==="\\"){this.cursor++}else if(ch==="["){do{if(ch===undefined)throw this.newSyntaxError("Unterminated character class");if(ch==="\\")this.cursor++;ch=input[this.cursor++]}while(ch!=="]")}else if(ch===undefined){throw this.newSyntaxError("Unterminated regex")}}while(ch!=="/");do{ch=input[this.cursor++]}while(ch>="a"&&ch<="z");this.cursor--;token.value=eval(input.substring(token.start,this.cursor))},lexOp:function(e){var t=this.token,n=this.source;var r=opTokens[e];var i=n[this.cursor];if(i in r){r=r[i];this.cursor++;i=n[this.cursor];if(i in r){r=r[i];this.cursor++;i=n[this.cursor]}}var s=r.op;if(definitions.assignOps[s]&&n[this.cursor]==="="){this.cursor++;t.type=ASSIGN;t.assignOp=definitions.tokenIds[definitions.opTypeNames[s]];s+="="}else{t.type=definitions.tokenIds[definitions.opTypeNames[s]];t.assignOp=null}t.value=s},lexIdent:function(e){var t=this.token,n=this.source;do{e=n[this.cursor++]}while(e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="$"||e==="_");this.cursor--;var r=n.substring(t.start,this.cursor);t.type=definitions.keywords[r]||IDENTIFIER;t.value=r},get:function(e){var t;while(this.lookahead){--this.lookahead;this.tokenIndex=this.tokenIndex+1&3;t=this.tokens[this.tokenIndex];if(t.type!==NEWLINE||this.scanNewlines)return t.type}this.skip();this.tokenIndex=this.tokenIndex+1&3;t=this.tokens[this.tokenIndex];if(!t)this.tokens[this.tokenIndex]=t={};var n=this.source;if(this.cursor===n.length)return t.type=END;t.start=this.cursor;t.lineno=this.lineno;var r=n[this.cursor++];if(r>="a"&&r<="z"||r>="A"&&r<="Z"||r==="$"||r==="_"){this.lexIdent(r)}else if(e&&r==="/"){this.lexRegExp(r)}else if(r in opTokens){this.lexOp(r)}else if(r==="."){this.lexDot(r)}else if(r>="1"&&r<="9"){this.lexNumber(r)}else if(r==="0"){this.lexZeroNumber(r)}else if(r==='"'||r==="'"){this.lexString(r)}else if(this.scanNewlines&&r==="\n"){t.type=NEWLINE;t.value="\n";this.lineno++}else{throw this.newSyntaxError("Illegal token")}t.end=this.cursor;return t.type},unget:function(){if(++this.lookahead===4)throw"PANIC: too much lookahead!";this.tokenIndex=this.tokenIndex-1&3},newSyntaxError:function(e){var t=new SyntaxError(e,this.filename,this.lineno);t.source=this.source;t.cursor=this.lookahead?this.tokens[this.tokenIndex+this.lookahead&3].start:this.cursor;return t}};return{Tokenizer:Tokenizer}}();Narcissus.parser=function(){function pushDestructuringVarDecls(e,t){for(var n in e){var r=e[n];if(r.type===IDENTIFIER){t.varDecls.push(r)}else{pushDestructuringVarDecls(r,t)}}}function StaticContext(e,t,n,r,i){this.parentScript=e;this.parentBlock=t;this.inFunction=n;this.inForLoopInit=r;this.nesting=i;this.allLabels=new Stack;this.currentLabels=new Stack;this.labeledTargets=new Stack;this.defaultTarget=null;Narcissus.options.ecma3OnlyMode&&(this.ecma3OnlyMode=true);Narcissus.options.parenFreeMode&&(this.parenFreeMode=true)}function Script(e,t){var n=new Node(e,scriptInit());var r=new StaticContext(n,n,t,false,NESTING_TOP);Statements(e,r,n);return n}function Node(e,t){var n=e.token;if(n){this.type=n.type;this.value=n.value;this.lineno=n.lineno;this.start=n.start;this.end=n.end}else{this.lineno=e.lineno}this.tokenizer=e;this.children=[];for(var r in t)this[r]=t[r]}function tokenString(e){var t=definitions.tokens[e];return/^\W/.test(t)?definitions.opTypeNames[t]:t.toUpperCase()}function blockInit(){return{type:BLOCK,varDecls:[]}}function scriptInit(){return{type:SCRIPT,funDecls:[],varDecls:[],modDecls:[],impDecls:[],expDecls:[],loadDeps:[],hasEmptyReturn:false,hasReturnWithValue:false,isGenerator:false}}function MaybeLeftParen(e,t){if(t.parenFreeMode)return e.match(LEFT_PAREN)?LEFT_PAREN:END;return e.mustMatch(LEFT_PAREN).type}function MaybeRightParen(e,t){if(t===LEFT_PAREN)e.mustMatch(RIGHT_PAREN)}function Statements(e,t,n){try{while(!e.done&&e.peek(true)!==RIGHT_CURLY){n.push(Statement(e,t))}}catch(r){if(e.done){e.unexpectedEOF=true}throw r}}function Block(e,t){e.mustMatch(LEFT_CURLY);var n=new Node(e,blockInit());Statements(e,t.update({parentBlock:n}).pushTarget(n),n);e.mustMatch(RIGHT_CURLY);return n}function Statement(e,t){var n,r,i,s,o,u,a,f=e.get(true),l,c,h;switch(f){case FUNCTION:return FunctionDefinition(e,t,true,t.nesting!==NESTING_TOP?STATEMENT_FORM:DECLARED_FORM);case LEFT_CURLY:i=new Node(e,blockInit());Statements(e,t.update({parentBlock:i}).pushTarget(i).nest(NESTING_SHALLOW),i);e.mustMatch(RIGHT_CURLY);return i;case IF:i=new Node(e);i.condition=HeadExpression(e,t);c=t.pushTarget(i).nest(NESTING_DEEP);i.thenPart=Statement(e,c);i.elsePart=e.match(ELSE)?Statement(e,c):null;return i;case SWITCH:i=new Node(e,{cases:[],defaultIndex:-1});i.discriminant=HeadExpression(e,t);c=t.pushTarget(i).nest(NESTING_DEEP);e.mustMatch(LEFT_CURLY);while((f=e.get())!==RIGHT_CURLY){switch(f){case DEFAULT:if(i.defaultIndex>=0)throw e.newSyntaxError("More than one switch default");case CASE:s=new Node(e);if(f===DEFAULT)i.defaultIndex=i.cases.length;else s.caseLabel=Expression(e,c,COLON);break;default:throw e.newSyntaxError("Invalid switch case")}e.mustMatch(COLON);s.statements=new Node(e,blockInit());while((f=e.peek(true))!==CASE&&f!==DEFAULT&&f!==RIGHT_CURLY)s.statements.push(Statement(e,c));i.cases.push(s)}return i;case FOR:i=new Node(e,LOOP_INIT);if(e.match(IDENTIFIER)){if(e.token.value==="each")i.isEach=true;else e.unget()}if(!t.parenFreeMode)e.mustMatch(LEFT_PAREN);c=t.pushTarget(i).nest(NESTING_DEEP);h=t.update({inForLoopInit:true});if((f=e.peek())!==SEMICOLON){if(f===VAR||f===CONST){e.get();s=Variables(e,h)}else if(f===LET){e.get();if(e.peek()===LEFT_PAREN){s=LetBlock(e,h,false)}else{h.parentBlock=i;i.varDecls=[];s=Variables(e,h)}}else{s=Expression(e,h)}}if(s&&e.match(IN)){i.type=FOR_IN;i.object=Expression(e,h);if(s.type===VAR||s.type===LET){u=s.children;if(u.length!==1&&s.destructurings.length!==1){throw new SyntaxError("Invalid for..in left-hand side",e.filename,s.lineno)}if(s.destructurings.length>0){i.iterator=s.destructurings[0]}else{i.iterator=u[0]}i.varDecl=s}else{if(s.type===ARRAY_INIT||s.type===OBJECT_INIT){s.destructuredNames=checkDestructuring(e,h,s)}i.iterator=s}}else{i.setup=s;e.mustMatch(SEMICOLON);if(i.isEach)throw e.newSyntaxError("Invalid for each..in loop");i.condition=e.peek()===SEMICOLON?null:Expression(e,h);e.mustMatch(SEMICOLON);l=e.peek();i.update=(t.parenFreeMode?l===LEFT_CURLY||definitions.isStatementStartCode[l]:l===RIGHT_PAREN)?null:Expression(e,h)}if(!t.parenFreeMode)e.mustMatch(RIGHT_PAREN);i.body=Statement(e,c);return i;case WHILE:i=new Node(e,{isLoop:true});i.condition=HeadExpression(e,t);i.body=Statement(e,t.pushTarget(i).nest(NESTING_DEEP));return i;case DO:i=new Node(e,{isLoop:true});i.body=Statement(e,t.pushTarget(i).nest(NESTING_DEEP));e.mustMatch(WHILE);i.condition=HeadExpression(e,t);if(!t.ecmaStrictMode){e.match(SEMICOLON);return i}break;case BREAK:case CONTINUE:i=new Node(e);c=t.pushTarget(i);if(e.peekOnSameLine()===IDENTIFIER){e.get();i.label=e.token.value}i.target=i.label?c.labeledTargets.find(function(e){return e.labels.has(i.label)}):c.defaultTarget;if(!i.target)throw e.newSyntaxError("Invalid "+(f===BREAK?"break":"continue"));if(!i.target.isLoop&&f===CONTINUE)throw e.newSyntaxError("Invalid continue");break;case TRY:i=new Node(e,{catchClauses:[]});i.tryBlock=Block(e,t);while(e.match(CATCH)){s=new Node(e);o=MaybeLeftParen(e,t);switch(e.get()){case LEFT_BRACKET:case LEFT_CURLY:e.unget();s.varName=DestructuringExpression(e,t,true);break;case IDENTIFIER:s.varName=e.token.value;break;default:throw e.newSyntaxError("missing identifier in catch");break}if(e.match(IF)){if(t.ecma3OnlyMode)throw e.newSyntaxError("Illegal catch guard");if(i.catchClauses.length&&!i.catchClauses.top().guard)throw e.newSyntaxError("Guarded catch after unguarded");s.guard=Expression(e,t)}MaybeRightParen(e,o);s.block=Block(e,t);i.catchClauses.push(s)}if(e.match(FINALLY))i.finallyBlock=Block(e,t);if(!i.catchClauses.length&&!i.finallyBlock)throw e.newSyntaxError("Invalid try statement");return i;case CATCH:case FINALLY:throw e.newSyntaxError(definitions.tokens[f]+" without preceding try");case THROW:i=new Node(e);i.exception=Expression(e,t);break;case RETURN:i=ReturnOrYield(e,t);break;case WITH:i=new Node(e);i.object=HeadExpression(e,t);i.body=Statement(e,t.pushTarget(i).nest(NESTING_DEEP));return i;case VAR:case CONST:i=Variables(e,t);break;case LET:if(e.peek()===LEFT_PAREN)i=LetBlock(e,t,true);else i=Variables(e,t);break;case DEBUGGER:i=new Node(e);break;case NEWLINE:case SEMICOLON:i=new Node(e,{type:SEMICOLON});i.expression=null;return i;default:if(f===IDENTIFIER){f=e.peek();if(f===COLON){r=e.token.value;if(t.allLabels.has(r))throw e.newSyntaxError("Duplicate label");e.get();i=new Node(e,{type:LABEL,label:r});i.statement=Statement(e,t.pushLabel(r).nest(NESTING_SHALLOW));i.target=i.statement.type===LABEL?i.statement.target:i.statement;return i}}i=new Node(e,{type:SEMICOLON});e.unget();i.expression=Expression(e,t);i.end=i.expression.end;break}MagicalSemicolon(e);return i}function MagicalSemicolon(e){var t;if(e.lineno===e.token.lineno){t=e.peekOnSameLine();if(t!==END&&t!==NEWLINE&&t!==SEMICOLON&&t!==RIGHT_CURLY)throw e.newSyntaxError("missing ; before statement")}e.match(SEMICOLON)}function ReturnOrYield(e,t){var n,r,i=e.token.type,s;var o=t.parentScript;if(i===RETURN){if(!t.inFunction)throw e.newSyntaxError("Return not in function")}else{if(!t.inFunction)throw e.newSyntaxError("Yield not in function");o.isGenerator=true}n=new Node(e,{value:undefined});s=e.peek(true);if(s!==END&&s!==NEWLINE&&s!==SEMICOLON&&s!==RIGHT_CURLY&&(i!==YIELD||s!==i&&s!==RIGHT_BRACKET&&s!==RIGHT_PAREN&&s!==COLON&&s!==COMMA)){if(i===RETURN){n.value=Expression(e,t);o.hasReturnWithValue=true}else{n.value=AssignExpression(e,t)}}else if(i===RETURN){o.hasEmptyReturn=true}if(o.hasReturnWithValue&&o.isGenerator)throw e.newSyntaxError("Generator returns a value");return n}function FunctionDefinition(e,t,n,r){var i;var s=new Node(e,{params:[]});if(s.type!==FUNCTION)s.type=s.value==="get"?GETTER:SETTER;if(e.match(IDENTIFIER))s.name=e.token.value;else if(n)throw e.newSyntaxError("missing function identifier");var o=new StaticContext(null,null,true,false,NESTING_TOP);e.mustMatch(LEFT_PAREN);if(!e.match(RIGHT_PAREN)){do{switch(e.get()){case LEFT_BRACKET:case LEFT_CURLY:e.unget();s.params.push(DestructuringExpression(e,o));break;case IDENTIFIER:s.params.push(e.token.value);break;default:throw e.newSyntaxError("missing formal parameter");break}}while(e.match(COMMA));e.mustMatch(RIGHT_PAREN)}i=e.get();if(i!==LEFT_CURLY)e.unget();if(i!==LEFT_CURLY){s.body=AssignExpression(e,o);if(s.body.isGenerator)throw e.newSyntaxError("Generator returns a value")}else{s.body=Script(e,true)}if(i===LEFT_CURLY)e.mustMatch(RIGHT_CURLY);s.end=e.token.end;s.functionForm=r;if(r===DECLARED_FORM)t.parentScript.funDecls.push(s);return s}function Variables(e,t,n){var r,i,s,o,u,a;a=e.token.type;switch(a){case VAR:case CONST:u=t.parentScript;break;case LET:u=t.parentBlock;break;case LEFT_PAREN:a=LET;u=n;break}r=new Node(e,{type:a,destructurings:[]});do{a=e.get();if(a===LEFT_BRACKET||a===LEFT_CURLY){e.unget();var f=DestructuringExpression(e,t,true);i=new Node(e,{type:IDENTIFIER,name:f,readOnly:r.type===CONST});r.push(i);pushDestructuringVarDecls(i.name.destructuredNames,u);r.destructurings.push({exp:f,decl:i});if(t.inForLoopInit&&e.peek()===IN){continue}e.mustMatch(ASSIGN);if(e.token.assignOp)throw e.newSyntaxError("Invalid variable initialization");i.initializer=AssignExpression(e,t);continue}if(a!==IDENTIFIER)throw e.newSyntaxError("missing variable name");i=new Node(e,{type:IDENTIFIER,name:e.token.value,readOnly:r.type===CONST});r.push(i);u.varDecls.push(i);if(e.match(ASSIGN)){if(e.token.assignOp)throw e.newSyntaxError("Invalid variable initialization");i.initializer=AssignExpression(e,t)}}while(e.match(COMMA));return r}function LetBlock(e,t,n){var r,i;r=new Node(e,{type:LET_BLOCK,varDecls:[]});e.mustMatch(LEFT_PAREN);r.variables=Variables(e,t,r);e.mustMatch(RIGHT_PAREN);if(n&&e.peek()!==LEFT_CURLY){i=new Node(e,{type:SEMICOLON,expression:r});n=false}if(n)r.block=Block(e,t);else r.expression=AssignExpression(e,t);return r}function checkDestructuring(e,t,n,r){if(n.type===ARRAY_COMP)throw e.newSyntaxError("Invalid array comprehension left-hand side");if(n.type!==ARRAY_INIT&&n.type!==OBJECT_INIT)return;var i={};var s,o,u,a,f,l=n.children;for(var c=0,h=l.length;c<h;c++){if(!(s=l[c]))continue;if(s.type===PROPERTY_INIT){f=s.children;a=f[1];u=f[0].value}else if(n.type===OBJECT_INIT){a=s;u=s.value}else{a=s;u=c}if(a.type===ARRAY_INIT||a.type===OBJECT_INIT){i[u]=checkDestructuring(e,t,a,r)}else{if(r&&a.type!==IDENTIFIER){throw e.newSyntaxError("missing name in pattern")}i[u]=a}}return i}function DestructuringExpression(e,t,n){var r=PrimaryExpression(e,t);r.destructuredNames=checkDestructuring(e,t,r,n);return r}function GeneratorExpression(e,t,n){return new Node(e,{type:GENERATOR,expression:n,tail:ComprehensionTail(e,t)})}function ComprehensionTail(e,t){var n,r,i,s,o;n=new Node(e,{type:COMP_TAIL});do{r=new Node(e,{type:FOR_IN,isLoop:true});if(e.match(IDENTIFIER)){if(e.token.value==="each")r.isEach=true;else e.unget()}o=MaybeLeftParen(e,t);switch(e.get()){case LEFT_BRACKET:case LEFT_CURLY:e.unget();r.iterator=DestructuringExpression(e,t);break;case IDENTIFIER:r.iterator=s=new Node(e,{type:IDENTIFIER});s.name=s.value;r.varDecl=i=new Node(e,{type:VAR});i.push(s);t.parentScript.varDecls.push(s);break;default:throw e.newSyntaxError("missing identifier")}e.mustMatch(IN);r.object=Expression(e,t);MaybeRightParen(e,o);n.push(r)}while(e.match(FOR));if(e.match(IF))n.guard=HeadExpression(e,t);return n}function HeadExpression(e,t){var n=MaybeLeftParen(e,t);var r=ParenExpression(e,t);MaybeRightParen(e,n);if(n===END&&!r.parenthesized){var i=e.peek();if(i!==LEFT_CURLY&&!definitions.isStatementStartCode[i])throw e.newSyntaxError("Unparenthesized head followed by unbraced body")}return r}function ParenExpression(e,t){var n=Expression(e,t.update({inForLoopInit:t.inForLoopInit&&e.token.type===LEFT_PAREN}));if(e.match(FOR)){if(n.type===YIELD&&!n.parenthesized)throw e.newSyntaxError("Yield expression must be parenthesized");if(n.type===COMMA&&!n.parenthesized)throw e.newSyntaxError("Generator expression must be parenthesized");n=GeneratorExpression(e,t,n)}return n}function Expression(e,t){var n,r;n=AssignExpression(e,t);if(e.match(COMMA)){r=new Node(e,{type:COMMA});r.push(n);n=r;do{r=n.children[n.children.length-1];if(r.type===YIELD&&!r.parenthesized)throw e.newSyntaxError("Yield expression must be parenthesized");n.push(AssignExpression(e,t))}while(e.match(COMMA))}return n}function AssignExpression(e,t){var n,r;if(e.match(YIELD,true))return ReturnOrYield(e,t);n=new Node(e,{type:ASSIGN});r=ConditionalExpression(e,t);if(!e.match(ASSIGN)){return r}switch(r.type){case OBJECT_INIT:case ARRAY_INIT:r.destructuredNames=checkDestructuring(e,t,r);case IDENTIFIER:case DOT:case INDEX:case CALL:break;default:throw e.newSyntaxError("Bad left-hand side of assignment");break}n.assignOp=e.token.assignOp;n.push(r);n.push(AssignExpression(e,t));return n}function ConditionalExpression(e,t){var n,r;n=OrExpression(e,t);if(e.match(HOOK)){r=n;n=new Node(e,{type:HOOK});n.push(r);n.push(AssignExpression(e,t.update({inForLoopInit:false})));if(!e.match(COLON))throw e.newSyntaxError("missing : after ?");n.push(AssignExpression(e,t))}return n}function OrExpression(e,t){var n,r;n=AndExpression(e,t);while(e.match(OR)){r=new Node(e);r.push(n);r.push(AndExpression(e,t));n=r}return n}function AndExpression(e,t){var n,r;n=BitwiseOrExpression(e,t);while(e.match(AND)){r=new Node(e);r.push(n);r.push(BitwiseOrExpression(e,t));n=r}return n}function BitwiseOrExpression(e,t){var n,r;n=BitwiseXorExpression(e,t);while(e.match(BITWISE_OR)){r=new Node(e);r.push(n);r.push(BitwiseXorExpression(e,t));n=r}return n}function BitwiseXorExpression(e,t){var n,r;n=BitwiseAndExpression(e,t);while(e.match(BITWISE_XOR)){r=new Node(e);r.push(n);r.push(BitwiseAndExpression(e,t));n=r}return n}function BitwiseAndExpression(e,t){var n,r;n=EqualityExpression(e,t);while(e.match(BITWISE_AND)){r=new Node(e);r.push(n);r.push(EqualityExpression(e,t));n=r}return n}function EqualityExpression(e,t){var n,r;n=RelationalExpression(e,t);while(e.match(EQ)||e.match(NE)||e.match(STRICT_EQ)||e.match(STRICT_NE)){r=new Node(e);r.push(n);r.push(RelationalExpression(e,t));n=r}return n}function RelationalExpression(e,t){var n,r;var i=t.update({inForLoopInit:false});n=ShiftExpression(e,i);while(e.match(LT)||e.match(LE)||e.match(GE)||e.match(GT)||!t.inForLoopInit&&e.match(IN)||e.match(INSTANCEOF)){r=new Node(e);r.push(n);r.push(ShiftExpression(e,i));n=r}return n}function ShiftExpression(e,t){var n,r;n=AddExpression(e,t);while(e.match(LSH)||e.match(RSH)||e.match(URSH)){r=new Node(e);r.push(n);r.push(AddExpression(e,t));n=r}return n}function AddExpression(e,t){var n,r;n=MultiplyExpression(e,t);while(e.match(PLUS)||e.match(MINUS)){r=new Node(e);r.push(n);r.push(MultiplyExpression(e,t));n=r}return n}function MultiplyExpression(e,t){var n,r;n=UnaryExpression(e,t);while(e.match(MUL)||e.match(DIV)||e.match(MOD)){r=new Node(e);r.push(n);r.push(UnaryExpression(e,t));n=r}return n}function UnaryExpression(e,t){var n,r,i;switch(i=e.get(true)){case DELETE:case VOID:case TYPEOF:case NOT:case BITWISE_NOT:case PLUS:case MINUS:if(i===PLUS)n=new Node(e,{type:UNARY_PLUS});else if(i===MINUS)n=new Node(e,{type:UNARY_MINUS});else n=new Node(e);n.push(UnaryExpression(e,t));break;case INCREMENT:case DECREMENT:n=new Node(e);n.push(MemberExpression(e,t,true));break;default:e.unget();n=MemberExpression(e,t,true);if(e.tokens[e.tokenIndex+e.lookahead-1&3].lineno===e.lineno){if(e.match(INCREMENT)||e.match(DECREMENT)){r=new Node(e,{postfix:true});r.push(n);n=r}}break}return n}function MemberExpression(e,t,n){var r,i,s,o;if(e.match(NEW)){r=new Node(e);r.push(MemberExpression(e,t,false));if(e.match(LEFT_PAREN)){r.type=NEW_WITH_ARGS;r.push(ArgumentList(e,t))}}else{r=PrimaryExpression(e,t)}while((o=e.get())!==END){switch(o){case DOT:i=new Node(e);i.push(r);e.mustMatch(IDENTIFIER);i.push(new Node(e));break;case LEFT_BRACKET:i=new Node(e,{type:INDEX});i.push(r);i.push(Expression(e,t));e.mustMatch(RIGHT_BRACKET);break;case LEFT_PAREN:if(n){i=new Node(e,{type:CALL});i.push(r);i.push(ArgumentList(e,t));break};default:e.unget();return r}r=i}return r}function ArgumentList(e,t){var n,r;n=new Node(e,{type:LIST});if(e.match(RIGHT_PAREN,true))return n;do{r=AssignExpression(e,t);if(r.type===YIELD&&!r.parenthesized&&e.peek()===COMMA)throw e.newSyntaxError("Yield expression must be parenthesized");if(e.match(FOR)){r=GeneratorExpression(e,t,r);if(n.children.length>1||e.peek(true)===COMMA)throw e.newSyntaxError("Generator expression must be parenthesized")}n.push(r)}while(e.match(COMMA));e.mustMatch(RIGHT_PAREN);return n}function PrimaryExpression(e,t){var n,r,i=e.get(true);switch(i){case FUNCTION:n=FunctionDefinition(e,t,false,EXPRESSED_FORM);break;case LEFT_BRACKET:n=new Node(e,{type:ARRAY_INIT});while((i=e.peek(true))!==RIGHT_BRACKET){if(i===COMMA){e.get();n.push(null);continue}n.push(AssignExpression(e,t));if(i!==COMMA&&!e.match(COMMA))break}if(n.children.length===1&&e.match(FOR)){r=new Node(e,{type:ARRAY_COMP,expression:n.children[0],tail:ComprehensionTail(e,t)});n=r}e.mustMatch(RIGHT_BRACKET);break;case LEFT_CURLY:var s,o;n=new Node(e,{type:OBJECT_INIT});e:if(!e.match(RIGHT_CURLY)){do{i=e.get();if((e.token.value==="get"||e.token.value==="set")&&e.peek()===IDENTIFIER){if(t.ecma3OnlyMode)throw e.newSyntaxError("Illegal property accessor");n.push(FunctionDefinition(e,t,true,EXPRESSED_FORM))}else{switch(i){case IDENTIFIER:case NUMBER:case STRING:s=new Node(e,{type:IDENTIFIER});break;case RIGHT_CURLY:if(t.ecma3OnlyMode)throw e.newSyntaxError("Illegal trailing ,");break e;default:if(e.token.value in definitions.keywords){s=new Node(e,{type:IDENTIFIER});break}throw e.newSyntaxError("Invalid property name")}if(e.match(COLON)){r=new Node(e,{type:PROPERTY_INIT});r.push(s);r.push(AssignExpression(e,t));n.push(r)}else{if(e.peek()!==COMMA&&e.peek()!==RIGHT_CURLY)throw e.newSyntaxError("missing : after property");n.push(s)}}}while(e.match(COMMA));e.mustMatch(RIGHT_CURLY)}break;case LEFT_PAREN:n=ParenExpression(e,t);e.mustMatch(RIGHT_PAREN);n.parenthesized=true;break;case LET:n=LetBlock(e,t,false);break;case NULL:case THIS:case TRUE:case FALSE:case IDENTIFIER:case NUMBER:case STRING:case REGEXP:n=new Node(e);break;default:throw e.newSyntaxError("missing operand");break}return n}function parse(e,t,n){var r=new lexer.Tokenizer(e,t,n);var i=Script(r,false);if(!r.done)throw r.newSyntaxError("Syntax error");return i}function parseStdin(e,t){for(;;){try{var n=new lexer.Tokenizer(e,"stdin",t.value);var r=Script(n,false);t.value=n.lineno;return r}catch(i){if(!n.unexpectedEOF)throw i;var s=readline();if(!s)throw i;e+="\n"+s}}}var lexer=Narcissus.lexer;var definitions=Narcissus.definitions;const StringMap=definitions.StringMap;const Stack=definitions.Stack;eval(definitions.consts);const NESTING_TOP=0,NESTING_SHALLOW=1,NESTING_DEEP=2;StaticContext.prototype={ecma3OnlyMode:false,parenFreeMode:false,update:function(e){var t={};for(var n in e){t[n]={value:e[n],writable:true,enumerable:true,configurable:true}}return Object.create(this,t)},pushLabel:function(e){return this.update({currentLabels:this.currentLabels.push(e),allLabels:this.allLabels.push(e)})},pushTarget:function(e){var t=e.isLoop||e.type===SWITCH;if(this.currentLabels.isEmpty()){return t?this.update({defaultTarget:e}):this}e.labels=new StringMap;this.currentLabels.forEach(function(t){e.labels.set(t,true)});return this.update({currentLabels:new Stack,labeledTargets:this.labeledTargets.push(e),defaultTarget:t?e:this.defaultTarget})},nest:function(e){var t=Math.max(this.nesting,e);return t!==this.nesting?this.update({nesting:t}):this}};definitions.defineProperty(Array.prototype,"top",function(){return this.length&&this[this.length-1]},false,false,true);var Np=Node.prototype={};Np.constructor=Node;Np.toSource=Object.prototype.toSource;Np.push=function(e){if(e!==null){if(e.start<this.start)this.start=e.start;if(this.end<e.end)this.end=e.end}return this.children.push(e)};Node.indentLevel=0;Np.toString=function(){var e=[];for(var t in this){if(this.hasOwnProperty(t)&&t!=="type"&&t!=="target")e.push({id:t,value:this[t]})}e.sort(function(e,t){return e.id<t.id?-1:1});const n="    ";var r=++Node.indentLevel;var i="{\n"+n.repeat(r)+"type: "+tokenString(this.type);for(t=0;t<e.length;t++)i+=",\n"+n.repeat(r)+e[t].id+": "+e[t].value;r=--Node.indentLevel;i+="\n"+n.repeat(r)+"}";return i};Np.getSource=function(){return this.tokenizer.source.slice(this.start,this.end)};const LOOP_INIT={isLoop:true};definitions.defineGetter(Np,"filename",function(){return this.tokenizer.filename});definitions.defineGetter(Np,"length",function(){throw new Error("Node.prototype.length is gone; "+"use n.children.length instead")});definitions.defineProperty(String.prototype,"repeat",function(e){var t="",n=this+t;while(--e>=0)t+=n;return t},false,false,true);const DECLARED_FORM=0,EXPRESSED_FORM=1,STATEMENT_FORM=2;return{parse:parse,parseStdin:parseStdin,Node:Node,DECLARED_FORM:DECLARED_FORM,EXPRESSED_FORM:EXPRESSED_FORM,STATEMENT_FORM:STATEMENT_FORM,Tokenizer:lexer.Tokenizer,FunctionDefinition:FunctionDefinition}}();var exports={definitions:Narcissus.definitions,lexer:Narcissus.lexer,parser:Narcissus.parser};if(typeof module!="undefined"){module.exports=exports}(function(){var e,t,n,r,i,s,o,u,a=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1},f=Array.prototype.slice;i=this.Narcissus||require("./narcissus_packed");u=this._||require("underscore");o=i.definitions.tokens;s=i.parser;e=s.Node;e.prototype.left=function(){return this.children[0]};e.prototype.right=function(){return this.children[1]};e.prototype.last=function(){return this.children[this.children.length-1]};e.prototype.walk=function(e,t,n,r){if(n==null)n=null;if(r==null)r=null;if(n)t(n,this,r);if(e.last)if(this.last()!=null)this.last().walk(e,t,this);if(this.thenPart!=null)this.thenPart.walk(e,t,this,"thenPart");if(this.elsePart!=null)this.elsePart.walk(e,t,this,"elsePart");if(this.cases){return u.each(this.cases,function(n){return n.statements.walk(e,t,n,"cases")})}};e.prototype.clone=function(t){var n;for(n in this){if(n==="tokenizer"||n==="length"||n==="filename")continue;if(t[n]==null)t[n]=this[n]}return new e(this.tokenizer,t)};e.prototype.toHash=function(e){var t,n,r;if(e==null)e=[];t={};r=function(t){if(!t)return null;if(t.toHash){if(a.call(e,t)>=0){return"--recursive "+t.id+"--"}t.id=e.push(t);return t.toHash(e)}else{return t}};t.type=this.typeName();t.src=this.src();for(n in this){if(n==="filename"||n==="length"||n==="type"||n==="start"||n==="end"||n==="tokenizer"){continue}if(typeof this[n]==="function")continue;if(!this[n])continue;if(this[n].constructor===Array){t[n]=u.map(this[n],function(e){return r(e)})}else{t[n]=r(this[n])}}return t};e.prototype.inspect=function(){return JSON.stringify(this.toHash(),null,"  ")};e.prototype.src=function(){return this.tokenizer.source.substr(this.start,this.end-this.start)};e.prototype.typeName=function(){return n[this.type]};e.prototype.isA=function(){var e,t;e=1<=arguments.length?f.call(arguments,0):[];return t=n[this.type],a.call(e,t)>=0};n=function(){var e,t,n;e={};n=0;for(t in o){if(typeof o[t]==="number"){e[o[t]]=t.toLowerCase();n=o[t]}}e[++n]="call_statement";e[++n]="existence_check";return e}();t=function(){var e,t;e={};for(t in n){e[n[t]]=t}return e}();this.NodeExt=r={Types:n,Typenames:t,Node:e};if(typeof module!=="undefined"&&module!==null)module.exports=r}).call(this);(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1};t=this.CoffeeScript||require("coffee-script");e=function(){function e(){this.code=""}e.prototype.add=function(e){this.code+=e.toString();return this};e.prototype.scope=function(e,t){var n;if(t==null)t=1;n=h("  ",t);this.code=l(this.code)+"\n";this.code+=n+l(e).replace(/\n/g,"\n"+n)+"\n";return this};e.prototype.toString=function(){return this.code};return e}();f=function(e){var t;t=e.toString();if(t.substr(0,1)==="("&&t.substr(-1,1)===")"){return t}else{return"("+t+")"}};h=function(e,t){var n;return function(){var r;r=[];for(n=0;0<=t?n<t:n>t;0<=t?n++:n--){r.push(e)}return r}().join("")};u=function(e){return(""+e).replace(/^\s*/g,"")};l=function(e){return(""+e).replace(/\s*$/g,"")};n=function(e){return(""+e).replace(/^\s*\n|\s*$/g,"")};p=function(e){return(""+e).replace(/^\s*|\s*$/g,"")};o=function(e){return p(e).indexOf("\n")===-1};m=function(e){var t,n;e=""+e;while(true){t=e.match(/^/gm);n=e.match(/^ /gm);if(!t||!n||t.length!==n.length)return e;e=e.replace(/^ /gm,"")}};d=function(e){return e.isA("true")||e.isA("number")&&parseFloat(e.src())!==0};c=function(e){return JSON.stringify(""+e)};a=function(e){if(e.constructor===String){console.log(JSON.stringify(e))}else{console.log(e)}return""};r=function(){var e,n,r,i;r=t.RESERVED;i=[];for(e=0,n=r.length;e<n;e++){g=r[e];if(g!=="undefined")i.push(g)}return i}();v=function(e){var t;if(t=""+e,y.call(r,t)>=0){return""+e+"_"}else{return""+e}};s=function(e,t){return e+t.replace(/\n/g,"\n"+e)};this.Js2coffeeHelpers=i={Code:e,p:a,strEscape:c,unreserve:v,unshift:m,isSingleLine:o,trim:p,blockTrim:n,ltrim:u,rtrim:l,strRepeat:h,paren:f,truthy:d,indentLines:s};if(typeof module!=="undefined"&&module!==null)module.exports=i}).call(this);(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1},k=Array.prototype.slice,L=Object.prototype.hasOwnProperty;v=(this.Narcissus||require("./narcissus_packed")).parser;x=this._||require("underscore");T=this.NodeExt||require("./node_ext"),s=T.Types,i=T.Typenames,n=T.Node;N=this.Js2coffeeHelpers||require("./helpers"),t=N.Code,p=N.p,g=N.strEscape,E=N.unreserve,S=N.unshift,c=N.isSingleLine,b=N.trim,u=N.blockTrim,h=N.ltrim,m=N.rtrim,y=N.strRepeat,d=N.paren,w=N.truthy,l=N.indentLines;a=function(t,n){var r,i,s,o,u,a,f,c,p,d,g,y,w,E,S,T;if(n==null)n={};t=t.replace(/\r/g,"");t+="\n";r=new e(n);g=v.parse(t);c=b(r.build(g));if(n.no_comments){return function(){var e,t,n,r;n=c.split("\n");r=[];for(e=0,t=n.length;e<t;e++){a=n[e];r.push(m(a))}return r}().join("\n")}else{o=n.show_src_lineno;d=[];T=c.split("\n");for(E=0,S=T.length;E<S;E++){u=T[E];y=[];w=u.replace(/\uFEFE([0-9]+).*?\uFEFE/g,function(e,t){y.push(parseInt(t));return""});y=x.sortBy(x.uniq(y),function(e){return e});w=m(w);s=w.match(/^\s*/);if(y.length>0){f=x.last(y);p=r.commentsNotDoneTo(f);if(p)d.push(l(s,p))}if(w){if(o)w=w+"#"+y.join(",")+"#  ";d.push(m(w+" "+h(r.lineComments(y))))}else{d.push("")}}i=r.commentsNotDoneTo(1e10);if(i)d.push(i);return d.join("\n")}};e=function(){function e(e){this.options=e!=null?e:{};this.transformer=new r}e.prototype.l=function(e){if(this.options.no_comments)return"";if(e&&e.lineno){return"﻾"+e.lineno+"﻾"}else{return""}};e.prototype.makeComment=function(e){var t,n;if(e.type==="BLOCK_COMMENT"){t=e.value.split("\n");if(t.length>0&&t[0].length>0&&t[0][0]==="*"){t=function(){var e,r,i;i=[];for(e=0,r=t.length;e<r;e++){n=t[e];i.push(n.replace(/^[\s\*]*/,""))}return i}();t=function(){var e,r,i;i=[];for(e=0,r=t.length;e<r;e++){n=t[e];i.push(n.replace(/[\s]*$/,""))}return i}();while(t.length>0&&t[0].length===0){t.shift()}while(t.length>0&&t[t.length-1].length===0){t.pop()}t.unshift("###");t.push("###")}else{t=function(){var e,r,i;i=[];for(e=0,r=t.length;e<r;e++){n=t[e];i.push("#"+n)}return i}()}}else{t=["#"+e.value]}if(e.nlcount>0)t.unshift("");return t.join("\n")};e.prototype.commentsNotDoneTo=function(e){var t,n;n=[];while(true){if(this.comments.length===0)break;t=this.comments[0];if(t.lineno<e){n.push(this.makeComment(t));this.comments.shift();continue}break}return n.join("\n")};e.prototype.lineComments=function(e){var t,n;n=function(){var n,r,i,s,o;i=this.comments;o=[];for(n=0,r=i.length;n<r;n++){t=i[n];if(s=t.lineno,C.call(e,s)>=0){o.push(t)}}return o}.call(this);this.comments=x.difference(this.comments,n);return function(){var e,r,i;i=[];for(e=0,r=n.length;e<r;e++){t=n[e];i.push(this.makeComment(t))}return i}.call(this).join("\n")};e.prototype.build=function(){var e,t,n,r,i;e=1<=arguments.length?k.call(arguments,0):[];r=e[0];if(!(this.comments!=null)){this.comments=x.sortBy(r.tokenizer.comments,function(e){return e.start})}this.transform(r);n="other";if(r!==void 0&&r.typeName)n=r.typeName();t=this[n]||this.other;i=t.apply(this,e);if(r.parenthesized){return d(i)}else{return i}};e.prototype.transform=function(){var e;e=1<=arguments.length?k.call(arguments,0):[];return this.transformer.transform.apply(this.transformer,e)};e.prototype.body=function(e,t){var n;if(t==null)t={};n=this.build(e,t);n=u(n);n=S(n);if(n.length>0){return n}else{return""}};e.prototype["script"]=function(e,n){var r,i=this;if(n==null)n={};r=new t;x.each(e.functions,function(e){return r.add(i.build(e))});x.each(e.nonfunctions,function(e){return r.add(i.build(e))});return r.toString()};e.prototype["property_identifier"]=function(e){var t;t=e.value.toString();if(t.match(/^([_\$a-z][_\$a-z0-9]*)$/i)||t.match(/^[0-9]+$/i)){return this.l(e)+t}else{return this.l(e)+g(t)}};e.prototype["identifier"]=function(e){if(e.value==="undefined"){return this.l(e)+"`undefined`"}else if(e.property_accessor){return this.l(e)+e.value.toString()}else{return this.l(e)+E(e.value.toString())}};e.prototype["number"]=function(e){return this.l(e)+(""+e.src())};e.prototype["id"]=function(e){if(e.property_accessor){return this.l(e)+e}else{return this.l(e)+E(e)}};e.prototype["id_param"]=function(e){var t;if((t=e.toString())==="undefined"){return this.l(e)+(""+e+"_")}else{return this.l(e)+this.id(e)}};e.prototype["return"]=function(e){if(!(e.value!=null)){return this.l(e)+"return\n"}else{return this.l(e)+("return "+this.build(e.value)+"\n")}};e.prototype[";"]=function(e){var t;if(e.expression==null){return""}else if(e.expression.typeName()==="object_init"){t=this.object_init(e.expression);if(e.parenthesized){return t}else{return""+S(u(t))+"\n"}}else{return this.build(e.expression)+"\n"}};e.prototype["new"]=function(e){return this.l(e)+("new "+this.build(e.left()))};e.prototype["new_with_args"]=function(e){return this.l(e)+("new "+this.build(e.left())+"("+this.build(e.right())+")")};e.prototype["unary_plus"]=function(e){return"+"+this.build(e.left())};e.prototype["unary_minus"]=function(e){return"-"+this.build(e.left())};e.prototype["this"]=function(e){return this.l(e)+"this"};e.prototype["null"]=function(e){return this.l(e)+"null"};e.prototype["true"]=function(e){return this.l(e)+"true"};e.prototype["false"]=function(e){return this.l(e)+"false"};e.prototype["void"]=function(e){return this.l(e)+"undefined"};e.prototype["debugger"]=function(e){return this.l(e)+"debugger\n"};e.prototype["break"]=function(e){return this.l(e)+"break\n"};e.prototype["continue"]=function(e){return this.l(e)+"continue\n"};e.prototype["~"]=function(e){return"~"+this.build(e.left())};e.prototype["typeof"]=function(e){return this.l(e)+("typeof "+this.build(e.left()))};e.prototype["index"]=function(e){var t;t=this.build(e.right());if(x.any(e.children,function(e){return e.typeName()==="object_init"&&e.children.length>1})){t="{"+t+"}"}return this.l(e)+(""+this.build(e.left())+"["+t+"]")};e.prototype["throw"]=function(e){return this.l(e)+("throw "+this.build(e.exception))};e.prototype["!"]=function(e){var t,n;n=e.left();t=1;while(n.isA("!")&&(n=n.left())){++t}if(t&1&&n.isA("==","!=","===","!==","in","instanceof")){n.negated=!n.negated;return this.build(n)}return this.l(e)+(""+(t&1?"not ":"!!")+this.build(n))};e.prototype["in"]=function(e){return this.binary_operator(e,"of")};e.prototype["+"]=function(e){return this.binary_operator(e,"+")};e.prototype["-"]=function(e){return this.binary_operator(e,"-")};e.prototype["*"]=function(e){return this.binary_operator(e,"*")};e.prototype["/"]=function(e){return this.binary_operator(e,"/")};e.prototype["%"]=function(e){return this.binary_operator(e,"%")};e.prototype[">"]=function(e){return this.binary_operator(e,">")};e.prototype["<"]=function(e){return this.binary_operator(e,"<")};e.prototype["&"]=function(e){return this.binary_operator(e,"&")};e.prototype["|"]=function(e){return this.binary_operator(e,"|")};e.prototype["^"]=function(e){return this.binary_operator(e,"^")};e.prototype["&&"]=function(e){return this.binary_operator(e,"and")};e.prototype["||"]=function(e){return this.binary_operator(e,"or")};e.prototype["<<"]=function(e){return this.binary_operator(e,"<<")};e.prototype["<="]=function(e){return this.binary_operator(e,"<=")};e.prototype[">>"]=function(e){return this.binary_operator(e,">>")};e.prototype[">="]=function(e){return this.binary_operator(e,">=")};e.prototype["==="]=function(e){return this.binary_operator(e,"is")};e.prototype["!=="]=function(e){return this.binary_operator(e,"isnt")};e.prototype[">>>"]=function(e){return this.binary_operator(e,">>>")};e.prototype["instanceof"]=function(e){return this.binary_operator(e,"instanceof")};e.prototype["=="]=function(e){return this.binary_operator(e,"is")};e.prototype["!="]=function(e){return this.binary_operator(e,"isnt")};e.prototype["binary_operator"]=function(){var e,t,n;e={is:"isnt","in":"not in",of:"not of","instanceof":"not instanceof"};for(t in e){if(!L.call(e,t))continue;n=e[t];e[n]=t}return function(t,n){if(t.negated)n=e[n];return this.l(t)+(""+this.build(t.left())+" "+n+" "+this.build(t.right()))}}();e.prototype["--"]=function(e){return this.increment_decrement(e,"--")};e.prototype["++"]=function(e){return this.increment_decrement(e,"++")};e.prototype["increment_decrement"]=function(e,t){if(e.postfix){return this.l(e)+(""+this.build(e.left())+t)}else{return this.l(e)+(""+t+this.build(e.left()))}};e.prototype["="]=function(e){var t;t=e.assignOp!=null?s[e.assignOp]+"=":"=";return this.l(e)+(""+this.build(e.left())+" "+t+" "+this.build(e.right()))};e.prototype[","]=function(e){var t,n=this;t=x.map(e.children,function(e){return n.l(e)+n.build(e)+"\n"});return t.join("")};e.prototype["regexp"]=function(e){var t,n,r,i;r=e.value.toString().match(/^\/(.*)\/([a-z]?)/);i=r[1];n=r[2];t=i[0];if(t===" "||t==="="){if(n.length>0){return this.l(e)+("RegExp("+g(i)+', "'+n+'")')}else{return this.l(e)+("RegExp("+g(i)+")")}}else{return this.l(e)+("/"+i+"/"+n)}};e.prototype["string"]=function(e){return this.l(e)+g(e.value)};e.prototype["call"]=function(e){if(e.right().children.length===0){return""+this.build(e.left())+"()"+this.l(e)}else{return""+this.build(e.left())+"("+this.build(e.right())+")"+this.l(e)}};e.prototype["call_statement"]=function(e){var t;t=this.build(e.left());if(e.left().isA("function"))t=d(t);if(e.right().children.length===0){return""+t+"()"+this.l(e)}else{return""+t+" "+this.build(e.right())+this.l(e)}};e.prototype["list"]=function(e){var t,n=this;t=x.map(e.children,function(t){if(e.children.length>1)t.is_list_element=true;return n.build(t)});return this.l(e)+t.join(", ")};e.prototype["delete"]=function(e){var t,n=this;t=x.map(e.children,function(e){return n.build(e)});t=t.join(", ");return this.l(e)+("delete "+t+"\n")};e.prototype["."]=function(e){var t,n,r;t=this.build(e.left());r=e.right();r.property_accessor=true;n=this.build(r);if(e.isThis&&e.isPrototype){return this.l(e)+"@::"}else if(e.isThis){return this.l(e)+("@"+n)}else if(e.isPrototype){return this.l(e)+(""+t+"::")}else if(e.left().isPrototype){return this.l(e)+(""+t+n)}else{return this.l(e)+(""+t+"."+n)}};e.prototype["try"]=function(e){var n,r=this;n=new t;n.add("try");n.scope(this.body(e.tryBlock));x.each(e.catchClauses,function(e){return n.add(r.build(e))});if(e.finallyBlock!=null){n.add("finally");n.scope(this.body(e.finallyBlock))}return this.l(e)+n};e.prototype["catch"]=function(e){var n,r;n=this.body(e.block);if(b(n).length===0)return"";r=new t;if(e.varName!=null){r.add("catch "+e.varName)}else{r.add("catch")}r.scope(this.body(e.block));return this.l(e)+r};e.prototype["?"]=function(e){return this.l(e)+("(if "+this.build(e.left())+" then "+this.build(e.children[1])+" else "+this.build(e.children[2])+")")};e.prototype["for"]=function(e){var n;n=new t;if(e.setup!=null)n.add(""+this.build(e.setup)+"\n");if(e.condition!=null){n.add("while "+this.build(e.condition)+"\n")}else{n.add("loop")}n.scope(this.body(e.body));if(e.update!=null)n.scope(this.body(e.update));return this.l(e)+n};e.prototype["for_in"]=function(e){var n;n=new t;n.add("for "+this.build(e.iterator)+" of "+this.build(e.object));n.scope(this.body(e.body));return this.l(e)+n};e.prototype["while"]=function(e){var n,r,i,s;r=new t;i=e.positive?"while":"until";n=this.body(e.body);if(w(e.condition)){s="loop"}else{s=""+i+" "+this.build(e.condition)}if(c(n)&&s!=="loop"){r.add(""+b(n)+"  "+s+"\n")}else{r.add(s);r.scope(n)}return this.l(e)+r};e.prototype["do"]=function(e){var n;n=new t;n.add("loop");n.scope(this.body(e.body));if(e.condition!=null){n.scope("break unless "+this.build(e.condition))}return this.l(e)+n};e.prototype["if"]=function(e){var n,r,i;r=new t;i=e.positive?"if":"unless";n=this.body(e.thenPart);e.condition.parenthesized=false;if(e.thenPart.isA("block")&&e.thenPart.children.length===0&&!(e.elsePart!=null)){console.log(e.thenPart);r.add(""+this.build(e.condition)+"\n")}else if(c(n)&&!(e.elsePart!=null)){r.add(""+b(n)+"  "+i+" "+this.build(e.condition)+"\n")}else{r.add(""+i+" "+this.build(e.condition));r.scope(this.body(e.thenPart));if(e.elsePart!=null){if(e.elsePart.typeName()==="if"){r.add("else "+this.build(e.elsePart).toString())}else{r.add(this.l(e.elsePart)+"else\n");r.scope(this.body(e.elsePart))}}}return this.l(e)+r};e.prototype["switch"]=function(e){var n,r,i=this;n=new t;n.add("switch "+this.build(e.discriminant)+"\n");r=false;x.each(e.cases,function(e){var t;if(e.value==="default"){n.scope(i.l(e)+"else")}else{if(r===true){n.add(i.l(e)+(", "+i.build(e.caseLabel)+"\n"))}else{n.add(i.l(e)+("  when "+i.build(e.caseLabel)))}}if(i.body(e.statements).length===0){r=true}else{r=false;n.add("\n");n.scope(i.body(e.statements),2)}return t=false});return this.l(e)+n};e.prototype["existence_check"]=function(e){return this.l(e)+(""+this.build(e.left())+"?")};e.prototype["array_init"]=function(e){if(e.children.length===0){return this.l(e)+"[]"}else{return this.l(e)+("["+this.list(e)+"]")}};e.prototype["property_init"]=function(e){var t,n;t=e.left();n=e.right();n.is_property_value=true;return""+this.property_identifier(t)+": "+this.build(n)};e.prototype["object_init"]=function(e,n){var r,i,s=this;if(n==null)n={};if(e.children.length===0){return this.l(e)+"{}"}else if(e.children.length===1&&!(e.is_property_value||e.is_list_element)){return this.build(e.children[0])}else{i=x.map(e.children,function(e){return s.build(e)});r=new t(this,e);r.scope(i.join("\n"));if(n.brackets!=null)r="{"+r+"}";return r}};e.prototype["function"]=function(e){var n,r,i,s=this;r=new t;i=x.map(e.params,function(e){if(e.constructor===String){return s.id_param(e)}else{return s.build(e)}});if(e.name)r.add(""+e.name+" = ");if(e.params.length>0){r.add("("+i.join(", ")+") ->")}else{r.add("->")}n=this.body(e.body);if(b(n).length>0){r.scope(n)}else{r.add("\n")}return this.l(e)+r};e.prototype["var"]=function(e){var t,n=this;t=x.map(e.children,function(e){return""+E(e.value)+" = "+(e.initializer!=null?n.build(e.initializer):"undefined")});return this.l(e)+x.compact(t).join("\n")+"\n"};e.prototype["other"]=function(e){return this.unsupported(e,""+e.typeName()+" is not supported yet")};e.prototype["getter"]=function(e){return this.unsupported(e,"getter syntax is not supported; use __defineGetter__")};e.prototype["setter"]=function(e){return this.unsupported(e,"setter syntax is not supported; use __defineSetter__")};e.prototype["label"]=function(e){return this.unsupported(e,"labels are not supported by CoffeeScript")};e.prototype["const"]=function(e){return this.unsupported(e,"consts are not supported by CoffeeScript")};e.prototype["block"]=function(){var e;e=1<=arguments.length?k.call(arguments,0):[];return this.script.apply(this,e)};e.prototype["unsupported"]=function(e,t){throw new o("Unsupported: "+t,e)};return e}();r=function(){function e(){}e.prototype.transform=function(){var e,t,n,r;e=1<=arguments.length?k.call(arguments,0):[];n=e[0];if(n.transformed!=null)return;r=n.typeName();t=this[r];if(t){t.apply(this,e);return n.transformed=true}};e.prototype["script"]=function(e){var t,n=this;e.functions=[];e.nonfunctions=[];x.each(e.children,function(t){if(t.isA("function")){return e.functions.push(t)}else{return e.nonfunctions.push(t)}});t=null;return x.each(e.nonfunctions,function(e){var n;if(e.expression!=null){n=e.expression;if((t!=null?t.isA("object_init"):void 0)&&n.isA("object_init")){e.parenthesized=true}else{e.parenthesized=false}return t=n}})};e.prototype["."]=function(e){e.isThis=e.left().isA("this");return e.isPrototype=e.right().isA("identifier")&&e.right().value==="prototype"};e.prototype[";"]=function(e){if(e.expression!=null){e.expression.parenthesized=false;if(e.expression.isA("call")){e.expression.type=i["call_statement"];return this.call_statement(e)}}};e.prototype["function"]=function(e){return e.body.walk({last:true},function(e,t,n){var r;if(t.isA("return")&&t.value){r=n?e[n]:e.children[e.children.length-1];if(r){r.type=i[";"];return r.expression=r.value}}})};e.prototype["switch"]=function(e){var t=this;return x.each(e.cases,function(e){var t,n,r;t=e.statements;n=t.children;if((r=t.last())!=null?r.isA("break"):void 0){return delete n[n.length-1]}})};e.prototype["call_statement"]=function(e){if(e.children[1]){return x.each(e.children[1].children,function(t,n){if(t.isA("function")&&n!==e.children[1].children.length-1){return t.parenthesized=true}})}};e.prototype["return"]=function(e){if(e.value&&e.value.isA("object_init")&&e.value.children.length>1){return e.value.parenthesized=true}};e.prototype["block"]=function(e){return this.script(e)};e.prototype["if"]=function(e){var t;if(e.thenPart.children.length===0&&((t=e.elsePart)!=null?t.children.length:void 0)>0){e.positive=false;e.thenPart=e.elsePart;delete e.elsePart}return this.inversible(e)};e.prototype["while"]=function(e){if(e.body.children.length===0){e.body.children.push(e.clone({type:i["continue"],value:"continue",children:[]}))}return this.inversible(e)};e.prototype["inversible"]=function(e){var t;this.transform(e.condition);t=e.positive!=null?e.positive:true;if(e.condition.isA("!=")){e.condition.type=i["=="];return e.positive=!t}else if(e.condition.isA("!")){e.condition=e.condition.left();return e.positive=!t}else{return e.positive=t}};e.prototype["=="]=function(e){if(e.right().isA("null","void")){e.type=i["!"];return e.children=[e.clone({type:i["existence_check"],children:[e.left()]})]}};e.prototype["!="]=function(e){if(e.right().isA("null","void")){e.type=i["existence_check"];return e.children=[e.left()]}};return e}();o=function(){function e(e,t){this.message=e;this.cursor=t.start;this.line=t.lineno;this.source=t.tokenizer.source}e.prototype.toString=function(){return this.message};return e}();this.Js2coffee=f={VERSION:"0.2.0",build:a,UnsupportedError:o};if(typeof module!=="undefined"&&module!==null)module.exports=f}).call(this)